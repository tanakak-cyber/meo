# Windowsタスクスケジューラ設定手順

Laravelのスケジュール機能（`php artisan schedule:run`）を1分ごとに実行するWindowsタスクスケジューラの設定手順です。

## 前提条件

- Laragon環境でLaravelプロジェクトが動作していること
- プロジェクトのパス: `C:\laragon\www\meo`

## 設定手順

### 1. タスクスケジューラを開く

1. Windowsキー + R を押す
2. `taskschd.msc` と入力してEnter
3. タスクスケジューラが開きます

### 2. 基本タスクの作成

1. 右側の「基本タスクの作成」をクリック
2. 名前: `Laravel Schedule Runner`
3. 説明: `Laravelのスケジュールコマンドを1分ごとに実行`
4. 「次へ」をクリック

### 3. トリガーの設定

1. 「タスクの開始時期」で「毎日」を選択
2. 「次へ」をクリック
3. 開始日時: 今日の日付
4. 開始時刻: 00:00（深夜0時）
5. 「次へ」をクリック

### 4. 操作の設定

1. 「プログラムの開始」を選択
2. 「次へ」をクリック
3. プログラム/スクリプト: `C:\laragon\bin\php\php-8.3.0\php.exe`
   - ※ LaragonのPHPパスを確認してください。バージョンが異なる場合は適宜変更
4. 引数の追加: `artisan schedule:run`
5. 開始場所: `C:\laragon\www\meo`
6. 「次へ」をクリック

### 5. 完了と詳細設定

1. 「完了」をクリック
2. 作成されたタスクを右クリック → 「プロパティ」を選択

### 6. 詳細設定の調整

#### 「全般」タブ
- 「最上位の特権で実行する」にチェック（必要に応じて）
- 「ユーザーがログオンしているかどうかにかかわらず実行する」を選択
- 「パスワードを保存しない」にチェック（ローカル環境の場合）

#### 「トリガー」タブ
1. 既存のトリガーを選択して「編集」をクリック
2. 「タスクの繰り返し」にチェック
3. 繰り返し間隔: `1分`
4. 継続時間: `無期限`
5. 「有効」にチェック
6. 「OK」をクリック

#### 「条件」タブ
- 「コンピューターをAC電源で使用している場合のみタスクを開始する」のチェックを**外す**
- 「タスクを開始するためにコンピューターをスリープ解除する」にチェック（必要に応じて）

#### 「設定」タブ
- 「タスクをすぐに実行できる場合は実行する」にチェック
- 「タスクが要求されたときに実行できない場合は、すぐに実行する」にチェック
- 「タスクが失敗した場合、再起動を要求する」にチェック（オプション）

### 7. 保存

「OK」をクリックして設定を保存します。

## 動作確認

### 手動実行で確認

1. タスクスケジューラで作成したタスクを右クリック
2. 「実行」を選択
3. 正常に実行されることを確認

### ログで確認

Laravelのログファイル（`storage/logs/laravel.log`）を確認して、スケジュールコマンドが実行されているか確認してください。

### コマンドで確認

Laragonのターミナルで以下を実行：

```bash
cd C:\laragon\www\meo
php artisan schedule:list
```

登録されているスケジュール一覧が表示されます。

## トラブルシューティング

### タスクが実行されない場合

1. **PHPパスの確認**
   - LaragonのPHPパスが正しいか確認
   - `C:\laragon\bin\php\php-8.3.0\php.exe` が存在するか確認

2. **作業ディレクトリの確認**
   - 開始場所が `C:\laragon\www\meo` になっているか確認

3. **権限の確認**
   - タスクスケジューラの「履歴」タブでエラーメッセージを確認

4. **手動実行の確認**
   - ターミナルで `php artisan schedule:run` を手動実行してエラーがないか確認

### ログの確認方法

1. タスクスケジューラでタスクを選択
2. 下部の「履歴」タブを確認
3. エラーがある場合は詳細を確認

## 注意事項

- PCが起動していないとタスクは実行されません
- スリープ状態でも実行されるように設定できますが、完全に電源が切れている場合は実行されません
- サーバー環境では、cronを使用することを推奨します

